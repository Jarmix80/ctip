<section
  class="config-section"
  x-data="databaseConfig()"
  x-init="init()"
  x-on:admin:database-test.window="testConnection()"
  data-initial='{{ config | tojson | safe }}'
>
  <header class="config-header">
    <div>
      <h2>Konfiguracja PostgreSQL</h2>
      <p>Parametry połączenia wykorzystywane przez kolektor CTIP oraz API.</p>
    </div>
    <div class="config-meta">
      <span class="config-dot" :class="testStatus"></span>
      <span class="config-meta-text" x-text="testMessage || 'Brak testu połączenia'">Brak testu połączenia</span>
    </div>
  </header>

  <form class="config-form" @submit.prevent="save">
    <div class="form-grid">
      <div class="form-field">
        <label for="db-host">Host</label>
        <input id="db-host" type="text" x-model="host" required>
      </div>
      <div class="form-field">
        <label for="db-port">Port</label>
        <input id="db-port" type="number" min="1" max="65535" x-model="port" required>
      </div>
      <div class="form-field">
        <label for="db-name">Baza</label>
        <input id="db-name" type="text" x-model="database" required>
      </div>
      <div class="form-field">
        <label for="db-user">Użytkownik</label>
        <input id="db-user" type="text" x-model="user" required>
      </div>
      <div class="form-field">
        <label for="db-password">Hasło</label>
        <input id="db-password" type="password" x-model="password" placeholder="Pozostaw puste, aby nie zmieniać">
        <p class="input-help" x-text="password ? 'Hasło zostanie zaktualizowane.' : (passwordSet ? 'Hasło jest ustawione.' : 'Brak hasła w konfiguracji.')"></p>
      </div>
      <div class="form-field">
        <label for="db-ssl">SSL mode</label>
        <select id="db-ssl" x-model="sslmode">
          <option value="disable">disable</option>
          <option value="require">require</option>
          <option value="verify-ca">verify-ca</option>
          <option value="verify-full">verify-full</option>
        </select>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" :disabled="saving">
        <template x-if="!saving">Zapisz konfigurację</template>
        <template x-if="saving">Trwa zapisywanie…</template>
      </button>
      <button type="button" class="btn-secondary" :disabled="testing" @click.prevent="testConnection">
        <template x-if="!testing">Testuj połączenie</template>
        <template x-if="testing">Testowanie…</template>
      </button>
    </div>

    <template x-if="error">
      <div class="form-message error" x-text="error"></div>
    </template>
    <template x-if="success">
      <div class="form-message success" x-text="success"></div>
    </template>
  </form>
</section>
